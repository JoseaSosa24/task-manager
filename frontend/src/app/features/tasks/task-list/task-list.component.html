<div class="max-w-6xl mx-auto p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-semibold">Mis Tareas</h1>
    <button mat-raised-button color="primary" (click)="openTaskForm()">
      <mat-icon>add</mat-icon> Crear Tarea
    </button>
  </div>

  <app-task-filters
    [loading]="loading"
    (filtersChanged)="onFiltersChanged($event)">
  </app-task-filters>

  <div class="relative">
    <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

    <div *ngIf="!loading" class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 my-6">
      <ng-container *ngFor="let task of filteredTasks">
        <mat-card
          class="transform transition hover:-translate-y-1 hover:shadow-lg"
          [ngClass]="{'border-l-4 border-red-500': isOverdue(task)}">
          <mat-card-header>
            <div class="flex justify-between items-start w-full">
              <h3 class="text-lg font-medium">{{ task.title }}</h3>
              <button mat-icon-button [matMenuTriggerFor]="taskMenu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #taskMenu="matMenu">
                <button mat-menu-item (click)="editTask(task)">
                  <mat-icon>edit</mat-icon> Editar
                </button>
                <button mat-menu-item (click)="deleteTask(task.id)">
                  <mat-icon>delete</mat-icon> Eliminar
                </button>
              </mat-menu>
            </div>
          </mat-card-header>

          <mat-card-content class="space-y-4">
            <p class="text-gray-600">{{ task.description }}</p>
            <div class="flex flex-wrap items-center gap-2">
              <mat-chip
                class="py-1"
                [ngClass]="'status-' + task.status.toLowerCase()">
                {{ getStatusLabel(task.status) }}
              </mat-chip>
              <mat-chip
                class="py-1"
                [ngClass]="'priority-' + task.priority.toLowerCase()">
                {{ getPriorityLabel(task.priority) }}
              </mat-chip>
              <div *ngIf="task.dueDate" class="flex items-center text-sm text-gray-500">
                <mat-icon class="text-base mr-1">schedule</mat-icon>
                {{ formatDate(task.dueDate) }}
              </div>
            </div>
          </mat-card-content>

          <mat-card-actions class="flex flex-wrap gap-2">
            <button mat-button (click)="changeStatus(task, 'TODO')" [disabled]="task.status === 'TODO'">Por Hacer</button>
            <button mat-button (click)="changeStatus(task, 'IN_PROGRESS')" [disabled]="task.status === 'IN_PROGRESS'">En Progreso</button>
            <button mat-button (click)="changeStatus(task, 'IN_REVIEW')" [disabled]="task.status === 'IN_REVIEW'">En Revisi√≥n</button>
            <button mat-button (click)="changeStatus(task, 'DONE')" [disabled]="task.status === 'DONE'">Completada</button>
          </mat-card-actions>
        </mat-card>
      </ng-container>
    </div>

    <div *ngIf="!loading && filteredTasks.length === 0" class="text-center py-16 space-y-4 text-gray-500">
      <mat-icon class="text-6xl">assignment</mat-icon>
      <h3 class="text-xl font-semibold">No hay tareas</h3>
      <p>Crea tu primera tarea para comenzar.</p>
      <button mat-raised-button color="primary" (click)="openTaskForm()">Crear Tarea</button>
    </div>
  </div>

  <app-task-form
    *ngIf="showTaskForm"
    [task]="selectedTask"
    (taskSaved)="onTaskSaved($event)"
    (cancelled)="onTaskFormCancelled()">
  </app-task-form>
</div>
